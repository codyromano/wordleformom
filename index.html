<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Kim's Wordle</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="app-header">
      <h1>Kim's Wordl<span id="debug-e">e</span></h1>
      <p class="subtitle" id="date-subtitle"></p>
    </div>
    
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('game')">Play</button>
      <button class="tab-btn" id="complimentsTab" onclick="switchTab('compliments')">
        Compliments
        <span class="tab-notification-bell" id="tabNotificationBadge" style="display: none;">üîî</span>
      </button>
    </div>

    <div class="tab-content" id="gameTab">
      <div class="board" id="board"></div>
      <div class="message" id="message"></div>
      
      <div class="keyboard" id="keyboard"></div>
    </div>

    <div class="tab-content" id="complimentsTabContent" style="display: none;">
      <div class="compliments-list" id="complimentsList"></div>
    </div>
  </div>

  <div class="compliment-modal" id="modal">
    <div class="compliment-content">
      <h2 id="modal-heading">üéâ Today's Word üéâ</h2>
      <p class="compliment-text" id="compliment"></p>
      <p class="compliment-from" id="from"></p>
      <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
  </div>

  <div class="version-number">v1.0.6</div>

  <script src="puzzles.js"></script>
  <script>

    // Format and display current date
    function formatDate() {
      const now = new Date();
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      
      const dayName = days[now.getDay()];
      const monthName = months[now.getMonth()];
      const date = now.getDate();
      
      // Add ordinal suffix
      let suffix = 'th';
      if (date === 1 || date === 21 || date === 31) suffix = 'st';
      else if (date === 2 || date === 22) suffix = 'nd';
      else if (date === 3 || date === 23) suffix = 'rd';
      
      return `${dayName}, ${monthName} ${date}${suffix}`;
    }
    
    document.getElementById('date-subtitle').textContent = formatDate();

    // Debug feature: tap "e" in Wordle 5 times to show answer
    let debugTapCount = 0;
    let debugOriginalText = '';
    document.getElementById('debug-e').addEventListener('click', function(e) {
      e.stopPropagation();
      debugTapCount++;
      if (debugTapCount === 5) {
        debugOriginalText = document.getElementById('date-subtitle').textContent;
        document.getElementById('date-subtitle').textContent = `Answer: ${TARGET_WORD.toUpperCase()}`;
        setTimeout(() => {
          document.getElementById('date-subtitle').textContent = debugOriginalText;
          debugTapCount = 0;
        }, 3000);
      }
    });

    // Get random puzzle
    const puzzleIndex = Math.floor(Math.random() * dailyPuzzles.length);
    const todaysPuzzle = dailyPuzzles[puzzleIndex];
    const TARGET_WORD = todaysPuzzle.word;
    const MAX_GUESSES = 6;

    let currentRow = 0;
    let currentTile = 0;
    let gameOver = false;
    const guesses = [];
    const keyStates = {};

    // Create board
    const board = document.getElementById('board');
    for (let i = 0; i < MAX_GUESSES; i++) {
      const row = document.createElement('div');
      row.className = 'row';
      for (let j = 0; j < 5; j++) {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.id = `tile-${i}-${j}`;
        row.appendChild(tile);
      }
      board.appendChild(row);
    }

    // Create keyboard
    const keyboard = document.getElementById('keyboard');
    const rows = [
      ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
      ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
      ['ENTER', 'Z', 'X', 'C', 'V', 'B', 'N', 'M', '‚å´']
    ];

    rows.forEach(row => {
      const rowDiv = document.createElement('div');
      rowDiv.className = 'keyboard-row';
      row.forEach(key => {
        const keyBtn = document.createElement('button');
        keyBtn.className = 'key';
        keyBtn.textContent = key;
        keyBtn.id = `key-${key}`;
        if (key === '‚å´' || key === 'ENTER') {
          keyBtn.classList.add('wide');
        }
        keyBtn.onclick = () => handleKey(key);
        rowDiv.appendChild(keyBtn);
      });
      keyboard.appendChild(rowDiv);
    });

    function handleKey(key) {
      if (gameOver) return;

      if (key === '‚å´') {
        deleteLetter();
      } else if (key === 'ENTER') {
        submitGuess();
      } else if (currentTile < 5) {
        addLetter(key);
      }
    }

    function addLetter(letter) {
      if (currentTile < 5) {
        const tile = document.getElementById(`tile-${currentRow}-${currentTile}`);
        tile.textContent = letter;
        tile.classList.add('filled');
        currentTile++;
      }
    }

    function deleteLetter() {
      if (currentTile > 0) {
        currentTile--;
        const tile = document.getElementById(`tile-${currentRow}-${currentTile}`);
        tile.textContent = '';
        tile.classList.remove('filled');
      }
    }

    function submitGuess() {
      if (currentTile !== 5) {
        showMessage('Not enough letters');
        return;
      }

      const guess = [];
      for (let i = 0; i < 5; i++) {
        const tile = document.getElementById(`tile-${currentRow}-${i}`);
        guess.push(tile.textContent);
      }
      const guessWord = guess.join('');

      // Check guess
      const result = checkGuess(guessWord);
      animateRow(currentRow, result, guessWord);

      if (guessWord === TARGET_WORD) {
        gameOver = true;
        setTimeout(() => {
          showCompliment();
        }, 2000);
      } else if (currentRow === MAX_GUESSES - 1) {
        gameOver = true;
        setTimeout(() => {
          showCompliment();
        }, 2000);
      } else {
        currentRow++;
        currentTile = 0;
      }
    }

    function checkGuess(guess) {
      const result = [];
      const targetLetters = TARGET_WORD.split('');
      const guessLetters = guess.split('');
      const used = new Array(5).fill(false);

      // Check for correct positions
      for (let i = 0; i < 5; i++) {
        if (guessLetters[i] === targetLetters[i]) {
          result[i] = 'correct';
          used[i] = true;
        }
      }

      // Check for present letters
      for (let i = 0; i < 5; i++) {
        if (result[i]) continue;
        
        let found = false;
        for (let j = 0; j < 5; j++) {
          if (!used[j] && guessLetters[i] === targetLetters[j]) {
            result[i] = 'present';
            used[j] = true;
            found = true;
            break;
          }
        }
        
        if (!found) {
          result[i] = 'absent';
        }
      }

      return result;
    }

    function animateRow(row, result, guess) {
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          const tile = document.getElementById(`tile-${row}-${i}`);
          tile.classList.add(result[i]);
          
          const letter = guess[i];
          const keyEl = document.getElementById(`key-${letter}`);
          
          if (!keyStates[letter] || 
              (keyStates[letter] === 'absent' && result[i] !== 'absent') ||
              (keyStates[letter] === 'present' && result[i] === 'correct')) {
            keyStates[letter] = result[i];
            keyEl.classList.remove('absent', 'present', 'correct');
            keyEl.classList.add(result[i]);
          }
        }, i * 300);
      }
    }

    function showMessage(msg) {
      const messageEl = document.getElementById('message');
      messageEl.textContent = msg;
      setTimeout(() => {
        messageEl.textContent = '';
      }, 2000);
    }

    function showCompliment() {
      document.getElementById('modal-heading').textContent = `üéâ Today's Word: ${TARGET_WORD} üéâ`;
      document.getElementById('compliment').textContent = todaysPuzzle.compliment;
      document.getElementById('from').textContent = todaysPuzzle.from;
      document.getElementById('modal').classList.add('show');
      createSnowflakes();
      
      // Save compliment to local storage
      saveCompliment(TARGET_WORD, todaysPuzzle.compliment, todaysPuzzle.from);
    }

    function closeModal() {
      document.getElementById('modal').classList.remove('show');
    }

    // Local storage functions
    function saveCompliment(word, compliment, from) {
      const compliments = getCompliments();
      const today = new Date().toISOString().split('T')[0];
      
      // Check if already saved for today
      const exists = compliments.some(c => c.word === word);
      if (!exists) {
        compliments.push({
          word: word,
          compliment: compliment,
          from: from,
          date: today,
          unread: true
        });
        localStorage.setItem('compliments', JSON.stringify(compliments));
        updateNotificationBadge();
      }
    }

    function getCompliments() {
      const saved = localStorage.getItem('compliments');
      return saved ? JSON.parse(saved) : [];
    }

    function updateNotificationBadge() {
      const compliments = getCompliments();
      const unreadCount = compliments.filter(c => c.unread).length;
      const badge = document.getElementById('tabNotificationBadge');
      
      if (unreadCount > 0) {
        badge.style.display = 'block';
      } else {
        badge.style.display = 'none';
      }
    }

    function markAllAsRead() {
      const compliments = getCompliments();
      compliments.forEach(c => c.unread = false);
      localStorage.setItem('compliments', JSON.stringify(compliments));
      updateNotificationBadge();
    }

    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Update tab content
      if (tabName === 'game') {
        document.getElementById('gameTab').style.display = 'block';
        document.getElementById('complimentsTabContent').style.display = 'none';
      } else if (tabName === 'compliments') {
        document.getElementById('gameTab').style.display = 'none';
        document.getElementById('complimentsTabContent').style.display = 'block';
        loadComplimentsList();
        markAllAsRead();
      }
    }

    function loadComplimentsList() {
      const compliments = getCompliments();
      const listEl = document.getElementById('complimentsList');
      
      if (compliments.length === 0) {
        listEl.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">No compliments yet! Keep playing to unlock them. ‚ù§Ô∏è</p>';
      } else {
        listEl.innerHTML = compliments.reverse().map(c => {
          const date = new Date(c.date);
          const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
          
          return `
            <div class="compliment-card">
              <div class="compliment-card-word">${c.word}</div>
              <div class="compliment-card-text">${c.compliment}</div>
              <div class="compliment-card-from">${c.from}</div>
              <div class="compliment-card-date">${formattedDate}</div>
            </div>
          `;
        }).join('');
      }
    }

    // Initialize notification badge on page load
    updateNotificationBadge();

    function createSnowflakes() {
      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const snowflake = document.createElement('div');
          snowflake.className = 'snowflake';
          snowflake.textContent = '‚ùÑ';
          snowflake.style.left = Math.random() * 100 + '%';
          snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
          snowflake.style.opacity = Math.random() * 0.6 + 0.4;
          document.body.appendChild(snowflake);
          
          setTimeout(() => snowflake.remove(), 5000);
        }, i * 100);
      }
    }

    // Keyboard support
    document.addEventListener('keydown', (e) => {
      if (gameOver) return;
      
      if (e.key === 'Enter') {
        handleKey('ENTER');
      } else if (e.key === 'Backspace') {
        handleKey('‚å´');
      } else if (/^[a-zA-Z]$/.test(e.key)) {
        handleKey(e.key.toUpperCase());
      }
    });

    // Mobile input handling
    const mobileInput = document.getElementById('mobileInput');
    const submitBtn = document.getElementById('submitBtn');
    
    function updateMobileButtons() {
      const isFull = mobileInput.value.length === 5;
      submitBtn.disabled = !isFull;
    }
    
    mobileInput.addEventListener('input', (e) => {
      if (gameOver) return;
      
      let value = e.target.value.toUpperCase().replace(/[^A-Z]/g, '');
      e.target.value = value;
      
      // Clear current row
      for (let i = 0; i < 5; i++) {
        const tile = document.getElementById(`tile-${currentRow}-${i}`);
        tile.textContent = '';
        tile.classList.remove('filled');
      }
      
      // Fill tiles with input value
      currentTile = 0;
      for (let i = 0; i < value.length && i < 5; i++) {
        const tile = document.getElementById(`tile-${currentRow}-${i}`);
        tile.textContent = value[i];
        tile.classList.add('filled');
        currentTile++;
      }
      
      updateMobileButtons();
    });
    
    mobileInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !submitBtn.disabled) {
        handleMobileSubmit();
      }
    });
    
    function handleMobileSubmit() {
      if (gameOver) return;
      submitGuess();
      mobileInput.value = '';
      updateMobileButtons();
    }
  </script>
</body>
</html>